# Dataset后端接口文档概览

[toc]

---

#### 1. 登录接口
- **URL:** `/login`
- **方法:** `POST`
- **权限:** 无需特定角色，但需要基本身份验证
- **描述:** 用户登录接口，只进行基本身份验证。
- **请求体:** 无需请求体。
- **成功响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "username": "用户名", "role": "角色" }`
- **失败响应:**
  - **代码:** `401 Unauthorized`
  - **内容:** `{ "message": "Invalid username or password" }`

#### 2. 管理员测试接口
- **URL:** `/secure`
- **方法:** `GET`
- **权限:** 需要管理员权限
- **描述:** 用于测试的受保护区域，仅管理员可访问。
- **请求体:** 无需请求体。
- **响应:**
  - **代码:** `200 OK`
  - **内容:** `"Hello, {username}! You are viewing a secure area."`

#### 3. 创建用户接口
- **URL:** `/users_creation`
- **方法:** `POST`
- **权限:** 管理员
- **描述:** 允许管理员创建新用户。
- **请求体:** 
  ```json
  {
    "username": "user1",
    "password": "pass1",
    "role": "user"
  }
  ```
- **成功响应:**
  - **代码:** `201 Created`
  - **内容:** `{ "id": "用户ID", "username": "用户名", "role": "角色", "message": "User created" }`
- **失败响应:**
  - **代码:** `400 Bad Request`（缺失用户名或密码）
  - **内容:** `{ "message": "Missing username or password" }`
  - **代码:** `409 Conflict`（用户名已存在）
  - **内容:** `{ "message": "Username already exists" }`

#### 4. 搜索用户接口
- **URL:** `/users/<username>`
- **方法:** `GET`
- **权限:** 管理员
- **描述:** 根据用户名检索用户信息。
- **请求体:** 无需请求体。
- **成功响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 1, "message": "User found", "user": { "id": "用户ID", "username": "用户名", "role": "角色" } }`
- **失败响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 0, "message": "User not found" }`

#### 5. 更新用户信息接口
- **URL:** `/users/<username>`
- **方法:** `PUT`
- **权限:** 管理员
- **描述:** 根据用户名更新用户的密码和角色。
- **请求体:** 
  ```json
  {
    "password": "newpass", // 可选
    "role": "admin" // 可选
  }
  ```
- **成功响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 1, "message": "User updated", "user": { "id": "用户ID", "username": "用户名", "role": "角色" } }`
- **失败响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 0, "message": "User not found" }`

#### 6. 删除用户接口
- **URL:** `/users/<username>`
- **方法:** `DELETE`
- **权限:** 管理员
- **描述:** 根据用户名删除用户，并返回已删除用户的信息。
- **请求体:** 无需请求体。
- **成功响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 1, "message": "User deleted successfully", "deletedUser": { "id": "用户ID", "username": "用户名", "role": "角色" } }`
- **失败响应:**
  - **代码:** `200 OK`
  - **内容:** `{

 "code": 0, "message": "User not found" }`

#### 7. 用户列表接口（分页）
- **URL:** `/users`
- **方法:** `GET`
- **权限:** 管理员
- **描述:** 分页显示所有用户的列表。
- **请求参数:** 
  - `page`: 页码（默认为1）
  - `per_page`: 每页显示的用户数量（默认为10）
- **响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "list": [{ "id": "用户ID", "username": "用户名", "password": "密码哈希", "role": "角色" }], "total": "总用户数" }`

---

#### 8. 预测文本接口
- **URL:** `/predict`
- **方法:** `POST`
- **权限:** 需要管理员或用户权限
- **描述:** 根据提供的模型名和版本进行文本预测，并存储预测结果。
- **请求体:** 
  ```json
  {
    "model_name": "my_model",
    "model_version": "v1",
    "text": "This is a sample text."
  }
  ```
- **成功响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 1, "data": { "text": "文本", "label": "标签", "source": "来源", "create_time": "创建时间" } }`

#### 9. 列出所有模型接口
- **URL:** `/models`
- **方法:** `GET`
- **权限:** 管理员或用户
- **描述:** 返回所有已注册模型的列表。
- **请求体:** 无需请求体。
- **响应:**
  - **代码:** `200 OK`
  - **内容:** `[{ "name": "模型名称", "versions": [{ "version": "版本", "stage": "阶段", "description": "描述", "creation_time": "创建时间" }] }]`

#### 10. 创建训练数据接口
- **URL:** `/dataset`
- **方法:** `POST`
- **权限:** 管理员
- **描述:** 添加新的训练数据。
- **请求体:** 
  ```json
  {
    "text": "text",
    "label": "0/1",
    "source": "source"
  }
  ```
- **成功响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 1, "data": { "text": "文本", "label": "标签", "source": "来源", "create_time": "创建时间" } }`

#### 11. 更新训练数据接口
- **URL:** `/dataset/<int:dataset_id>`
- **方法:** `PUT`
- **权限:** 管理员
- **描述:** 根据数据ID更新训练数据。
- **请求体:** 
  ```json
  {
    "text": "new text",
    "label": "new label",
    "source": "new source"
  }
  ```
- **成功响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 1, "data": { "text": "更新后文本", "label": "标签", "source": "来源", "create_time": "更新时间" } }`
- **失败响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 0, "error": "Dataset not found" }`

#### 12. 删除训练数据接口
- **URL:** `/dataset/<int:dataset_id>`
- **方法:** `DELETE`
- **权限:** 管理员
- **描述:** 删除指定ID的训练数据。
- **请求体:** 无需请求体。
- **成功响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 1, "message": "Dataset deleted successfully", "deletedDataset": { "id": "数据ID", "text": "文本", "label": "标

签", "source": "来源", "delete_time": "删除时间" } }`
- **失败响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "code": 0, "message": "Dataset not found" }`

#### 13. 列出所有训练数据接口
- **URL:** `/datasets`
- **方法:** `GET`
- **权限:** 管理员
- **描述:** 分页显示所有训练数据。
- **请求参数:** 
  - `page`: 页码（默认为1）
  - `per_page`: 每页记录数（默认为10）
- **响应:**
  - **代码:** `200 OK`
  - **内容:** `{ "page": "当前页码", "per_page": "每页记录数", "total": "总记录数", "pages": "总页数", "data": [{ "text": "文本", "label": "标签", "source": "来源", "create_time": "创建时间" }] }`

---

#### 14. 根据 ID 或 Label 查询训练数据

- **URL:** `/datasets/search`
- **方法:** `GET`
- **权限:** 管理员
- **描述:** 根据提供的 `dataset_id` 或 `label` 进行查询。如果提供了 `dataset_id`，将优先使用 `dataset_id` 进行查询。如果同时提供了 `dataset_id` 和 `label`，将根据两者进行精确匹配。如果只提供 `label`，则返回所有匹配该标签的数据。
- **请求参数:** 
  - `dataset_id`: 数据集的唯一标识符（可选）
  - `label`: 数据集的标签（可选）
  - `page`: 页码（默认为1）
  - `per_page`: 每页记录数（默认为10）
- **成功响应:** 
  - **代码:** `200 OK`
  - **内容:** 
    ```json
    {
      "data": [
        {
          "create_time": "时间戳",
          "id": "数据ID",
          "label": "标签",
          "source": "来源",
          "text": "文本内容"
        }
      ],
      "page": "当前页码",
      "pages": "总页数",
      "per_page": "每页记录数",
      "total": "符合条件的总记录数"
    }
    ```
- **失败响应:**
  - **代码:** `200 OK`
  - **内容:** 
    ```json
    {
      "code": 0,
      "error": "错误信息，例如：'No datasets found with the provided criteria, please check your label' 或 'No dataset found with the provided ID'"
    }
    ```

- **使用示例**：

  - 查询指定 ID 的数据集：`GET /datasets/search?dataset_id=123`

  - 根据标签查询数据集：`GET /datasets/search?label=1`

  - 根据 ID 和标签同时查询（精确匹配）：`GET /datasets/search?dataset_id=123&label=1`

  - 分页查询标签为1的数据集：`GET /datasets/search?label=1&page=2&per_page=40`
